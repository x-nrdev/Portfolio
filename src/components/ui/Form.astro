---
import FormContent from "../FormContent.astro";
import FormContentES from "../FormContentES.astro";

const { lang, class: className = "" } = Astro.props;

// TODO: Create modal component
// TODO: Create popup of sending on email success
---

{
    lang === "es" ? (
        <FormContentES class:list={[className]} />
    ) : (
        <FormContent class:list={[className]} />
    )
}

<script>
    import { addValidationClasses } from "@utils/formValidation";
    import { navigate } from "astro:transitions/client";

    const initializeForm = () => {
        const inputName = document.querySelector(
            ".input-name"
        ) as HTMLInputElement;
        const inputEmail = document.querySelector(
            ".input-email"
        ) as HTMLInputElement;
        const inputMsg = document.querySelector(
            ".input-msg"
        ) as HTMLTextAreaElement;
        const requiredInputs = [inputName, inputEmail, inputMsg];
        const submitBtn = document.querySelector("button") as HTMLButtonElement;

        const handleInput = (event: Event) => {
            if (
                event.target instanceof HTMLInputElement ||
                event.target instanceof HTMLTextAreaElement
            ) {
                addValidationClasses(event.target as HTMLInputElement);
            }
        };

        const handleSubmit = () => {
            const formIsValid = requiredInputs.every((input) => {
                return input.checkValidity();
            });

            if (formIsValid) {
                // TODO: Show Popup of sending email
                console.log("Sending email...");
                setTimeout(() => {
                    console.log("Email sent!");
                    navigate("/");
                }, 3000);
            }
        };

        requiredInputs.forEach((input) => {
            input.addEventListener("input", handleInput);
        });

        submitBtn.addEventListener("click", handleSubmit);

        inputName.focus();
    };

    initializeForm();
    document.addEventListener("astro:after-swap", initializeForm);
</script>
